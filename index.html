<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>VSPhone ‚Äì Qu·∫£n l√Ω t√†i kho·∫£n</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #fff;
  color: #000;
  padding: 20px;
}
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
}
th, td {
  border: 1px solid #ccc;
  padding: 8px;
  text-align: left;
}
th {
  background: #eee;
}
.btn {
  padding: 4px 10px;
  background: #007bff;
  color: #fff;
  border: none;
  cursor: pointer;
}
.btn:hover {
  background: #0056b3;
}
.password-cell {
  font-family: monospace;
}
</style>
</head>

<body>

<h2>VSPhone ‚Äì Qu·∫£n l√Ω t√†i kho·∫£n</h2>
<p>D·ªØ li·ªáu load tr·ª±c ti·∫øp t·ª´ Google Sheets.</p>

<table id="accountTable">
  <thead>
    <tr>
      <th>#</th>
      <th>N·ªÅn t·∫£ng</th>
      <th>Email</th>
      <th>Password</th>
      <th>Tr·∫°ng th√°i</th>
      <th>Thao t√°c</th>
    </tr>
  </thead>
  <tbody id="tbody">
    <tr><td colspan="6">ƒêang t·∫£i d·ªØ li·ªáu...</td></tr>
  </tbody>
</table>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script>
const SHEET_JSON_URL =
  'https://opensheet.elk.sh/1fU4ppbOWDikPkEWUdXiyqrUn8JHXvt-PJjS778J-R8M/Trang%20t%C3%ADnh1';

async function loadSheet() {
  try {
    const res = await fetch(SHEET_JSON_URL);
    const data = await res.json();

    console.log('[SHEET DATA]', data);

    if (!Array.isArray(data) || data.length === 0) {
      document.querySelector('#tbody').innerHTML =
        '<tr><td colspan="6">‚ùå Sheet r·ªóng</td></tr>';
      return;
    }

    renderTable(data);
  } catch (e) {
    console.error(e);
    document.querySelector('#tbody').innerHTML =
      '<tr><td colspan="6">‚ùå L·ªói load sheet</td></tr>';
  }
}

function renderTable(rows) {
  const tbody = document.querySelector('#tbody');
  tbody.innerHTML = '';

  rows.forEach((row, i) => {
    const email = row.email?.trim();
    const pass = row.password?.trim();

    if (!email || !pass) return;

    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${i + 1}</td>
      <td>${row.platform || 'VSPhone'}</td>
      <td>${email}</td>
      <td class="password-cell">${pass}</td>
      <td>${row.status || ''}</td>
      <td>
        <button class="btn" onclick="login('${email}','${pass}')">
          üöÄ LOGIN
        </button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

function login(email, pass) {
  console.log('[LOGIN]', email, pass);

  // M·ªü tab login
  const newWin = window.open('https://cloud.vsphone.com/login', '_blank');

  // Chu·∫©n b·ªã d·ªØ li·ªáu g·ª≠i
  const creds = { type: 'AUTO_LOGIN', email, password: pass };
  const targetOrigin = 'https://cloud.vsphone.com';

  // G·ª≠i message sau 1 gi√¢y (ƒë·∫£m b·∫£o tab ƒë√£ load)
  setTimeout(() => {
    newWin.postMessage(creds, targetOrigin);
    console.log('[LOGIN] Credentials sent via postMessage');
  }, 1000);
}

loadSheet();
</script>

</body>
</html>
